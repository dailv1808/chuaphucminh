import{g as t}from"./config-BvOGzWpZ.js";import"./auth-BxmWGv8U.js";document.addEventListener("alpine:init",function(){Alpine.data("qaData",function(){return{questions:[],filteredQuestions:[],searchQuery:"",statusFilter:"",priorityFilter:"",sortBy:"newest",showQuestionModal:!1,showConfirmModal:!1,isEditing:!1,isLoading:!0,showNotification:!1,notificationMessage:"",notificationType:"success",currentPage:1,perPage:10,statusLabels:{pending:"Chờ trả lời",answered:"Đã trả lời",archived:"Lưu trữ"},priorityLabels:{high:"Ưu tiên cao",medium:"Ưu tiên trung",low:"Ưu tiên thấp"},currentQuestion:{id:null,name:"",email:"",content:"",short_content:"",answer:"",answered_at:null,status:"pending",priority:"medium",group:null,tags:[],created_at:(new Date).toISOString()},init:function(){this.fetchQuestions()},get paginatedQuestions(){const t=(this.currentPage-1)*this.perPage,e=t+this.perPage;return this.filteredQuestions.slice(t,e)},get totalPages(){return Math.ceil(this.filteredQuestions.length/this.perPage)},fetchQuestions:function(){this.isLoading=!0,fetch(t("/api/questions/")).then(t=>{if(!t.ok)throw new Error("Lỗi khi tải danh sách câu hỏi");return t.json()}).then(t=>{this.questions=t.map(t=>({...t,showAnswerSection:!1,newAnswer:""})),this.applyFilters()}).catch(t=>{console.error("Error:",t),this.showNotificationMessage(t.message,"error")}).finally(()=>{this.isLoading=!1})},applyFilters:function(){this.currentPage=1,this.sortAndFilterQuestions()},sortAndFilterQuestions:function(){let t=[...this.questions];if(this.searchQuery){const e=this.searchQuery.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.content.toLowerCase().includes(e)||t.short_content&&t.short_content.toLowerCase().includes(e)||t.answer&&t.answer.toLowerCase().includes(e))}this.statusFilter&&(t=t.filter(t=>t.status===this.statusFilter)),this.priorityFilter&&(t=t.filter(t=>t.priority===this.priorityFilter)),"newest"===this.sortBy?t.sort((t,e)=>new Date(e.created_at)-new Date(t.created_at)):t.sort((t,e)=>new Date(t.created_at)-new Date(e.created_at)),this.filteredQuestions=t},goToPage:function(t){this.currentPage=t},prevPage:function(){this.currentPage>1&&this.currentPage--},nextPage:function(){this.currentPage<this.totalPages&&this.currentPage++},showReplySection:function(t){this.questions.forEach(t=>t.showAnswerSection=!1),t.showAnswerSection=!0,t.newAnswer=""},cancelReply:function(t){t.showAnswerSection=!1,t.newAnswer=""},submitReply:function(t){t.newAnswer.trim()?(t.answer=t.newAnswer,t.answered_at=(new Date).toISOString(),t.status="answered",t.showAnswerSection=!1,this.currentQuestion={...t},this.updateQuestion()):this.showNotificationMessage("Vui lòng nhập nội dung trả lời","error")},updateAnsweredAt:function(){this.currentQuestion.answer&&!this.currentQuestion.answered_at?(this.currentQuestion.answered_at=(new Date).toISOString(),this.currentQuestion.status="answered"):this.currentQuestion.answer||(this.currentQuestion.answered_at=null,this.currentQuestion.status="pending")},openAddQuestionModal:function(){this.isEditing=!1,this.currentQuestion={id:null,name:"",email:"",content:"",short_content:"",answer:"",answered_at:null,status:"pending",priority:"medium",group:null,tags:[],created_at:(new Date).toISOString()},this.showQuestionModal=!0},openEditQuestionModal:function(t){this.isEditing=!0,this.currentQuestion=JSON.parse(JSON.stringify(t)),Array.isArray(this.currentQuestion.tags)&&(this.currentQuestion.tags=this.currentQuestion.tags.join(", ")),this.showQuestionModal=!0},closeQuestionModal:function(){this.showQuestionModal=!1},saveQuestion:function(){this.currentQuestion.name.trim()&&this.currentQuestion.email.trim()&&this.currentQuestion.content.trim()?this.isEditing?this.updateQuestion():this.createQuestion():this.showNotificationMessage("Vui lòng điền đầy đủ thông tin bắt buộc","error")},preparePayload:function(){const t={...this.currentQuestion};return this.updateAnsweredAt(),t.tags="string"==typeof t.tags?t.tags.split(",").map(t=>t.trim()).filter(t=>t):Array.isArray(t.tags)?t.tags:[],t},createQuestion:function(){const e=this.preparePayload();fetch(t("/api/questions/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>{if(!t.ok)throw new Error("Thêm mới thất bại");return t.json()}).then(()=>{this.showNotificationMessage("Thêm câu hỏi mới thành công","success"),this.showQuestionModal=!1,this.fetchQuestions()}).catch(t=>{console.error("Error:",t),this.showNotificationMessage(t.message,"error")})},updateQuestion:function(){const e=this.preparePayload(),i=localStorage.getItem("access_token");fetch(t(`/api/questions/${this.currentQuestion.id}/`),{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>{if(!t.ok)throw new Error("Cập nhật thất bại");return t.json()}).then(()=>{this.showNotificationMessage("Cập nhật câu hỏi thành công","success"),this.showQuestionModal=!1,this.fetchQuestions()}).catch(t=>{console.error("Error:",t),this.showNotificationMessage(t.message,"error")})},confirmDelete:function(t){this.currentQuestion={...t},this.showConfirmModal=!0},deleteQuestion:function(){const e=localStorage.getItem("access_token");fetch(t(`/api/questions/${this.currentQuestion.id}/`),{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}).then(t=>{if(!t.ok)throw new Error("Xóa câu hỏi thất bại");this.showNotificationMessage("Xóa câu hỏi thành công","success"),this.showConfirmModal=!1,this.fetchQuestions()}).catch(t=>{console.error("Error:",t),this.showNotificationMessage(t.message,"error")})},formatDateTime:function(t){if(!t)return"N/A";return new Date(t).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},showNotificationMessage:function(t,e){this.notificationMessage=t,this.notificationType=e,this.showNotification=!0,setTimeout(()=>this.showNotification=!1,3e3)}}})});
