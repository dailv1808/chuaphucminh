import{g as e}from"./config-BvOGzWpZ.js";document.addEventListener("alpine:init",()=>{Alpine.data("loginForm",()=>({form:{username:"",password:"",remember:!1},loading:!1,error:null,async handleLogin(){this.loading=!0,this.error=null;try{const o=await fetch(e("/api/accounts/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.form.username,password:this.form.password})}),s=await o.text();let t={};try{t=s?JSON.parse(s):{}}catch(r){throw console.error("Failed to parse JSON:",r),new Error("Invalid server response")}if(!o.ok)throw new Error(t.detail||t.message||"Đăng nhập thất bại");if(!t.access||!t.refresh)throw new Error("Thiếu token trong response");localStorage.setItem("access_token",t.access),localStorage.setItem("refresh_token",t.refresh),t.user&&localStorage.setItem("user",JSON.stringify(t.user));const n=new URLSearchParams(window.location.search).get("next")||"/index.html";window.location.href=n}catch(o){this.error=o.message||"Lỗi khi đăng nhập",console.error("Login error:",o)}finally{this.loading=!1}}}))});
