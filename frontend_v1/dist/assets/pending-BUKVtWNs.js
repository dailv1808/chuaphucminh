import{g as t}from"./config-BvOGzWpZ.js";/* empty css             */import"./auth-BxmWGv8U.js";document.addEventListener("alpine:init",()=>{Alpine.data("pendingData",()=>({registrations:[],filteredRegistrations:[],searchQuery:"",showDetail:!1,showRejectReasonModal:!1,selectedRegistration:null,selectedRejectId:null,rejectReason:"",isLoading:!0,showNotification:!1,notificationMessage:"",notificationType:"success",init(){this.fetchRegistrations()},async fetchRegistrations(){try{this.isLoading=!0;const e=await fetch(t("/api/registration/"),{headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Network response was not ok");const i=await e.json();this.registrations=i.filter(t=>"pending"===t.status),this.filteredRegistrations=[...this.registrations]}catch(e){console.error("Error fetching registrations:",e),this.showNotificationMessage("Có lỗi xảy ra khi tải dữ liệu","error")}finally{this.isLoading=!1}},calculateDuration(t,e){if(!t||!e)return 0;const i=new Date(t),s=new Date(e),o=Math.abs(s-i);return Math.ceil(o/864e5)},formatDate(t){if(!t)return"N/A";return new Date(t).toLocaleDateString("vi-VN")},formatDateTime(t){if(!t)return"N/A";return new Date(t).toLocaleString("vi-VN")},formatStatus:t=>({pending:{text:"Chờ duyệt",color:"bg-amber-100 text-amber-800"},approved:{text:"Đã duyệt",color:"bg-green-100 text-green-800"},rejected:{text:"Đã từ chối",color:"bg-red-100 text-red-800"}}[t]||{text:t,color:"bg-gray-100 text-gray-800"}),filterRegistrations(){if(!this.searchQuery)return void(this.filteredRegistrations=[...this.registrations]);const t=this.searchQuery.toLowerCase();this.filteredRegistrations=this.registrations.filter(e=>e.fullname.toLowerCase().includes(t)||e.phone_number.includes(t)||e.cccd&&e.cccd.includes(t)||e.address&&e.address.toLowerCase().includes(t))},showNotificationMessage(t,e="success"){this.notificationMessage=t,this.notificationType=e,this.showNotification=!0,setTimeout(()=>{this.showNotification=!1},3e3)},showRegistrationDetail(t){this.selectedRegistration=t,this.showDetail=!0},showRejectModal(t){this.selectedRejectId=t,this.rejectReason="",this.showRejectReasonModal=!0,this.showDetail=!1},async approveRegistration(e){try{const i=localStorage.getItem("access_token");if(!(await fetch(t(`/api/registration/${e}/`),{method:"PATCH",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({status:"approved"})})).ok)throw new Error("Approval failed");this.showNotificationMessage("Đã duyệt thành công","success"),this.fetchRegistrations(),this.showDetail=!1}catch(i){console.error("Approval error:",i),this.showNotificationMessage("Có lỗi xảy ra khi duyệt","error")}},async rejectRegistration(){if(this.rejectReason.trim())try{const e=localStorage.getItem("access_token");if(!(await fetch(t(`/api/registration/${this.selectedRejectId}/`),{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({status:"rejected",reject_reason:this.rejectReason})})).ok)throw new Error("Rejection failed");this.showNotificationMessage("Đã từ chối thành công","success"),this.fetchRegistrations(),this.showRejectReasonModal=!1}catch(e){console.error("Rejection error:",e),this.showNotificationMessage("Có lỗi xảy ra khi từ chối","error")}else this.showNotificationMessage("Vui lòng nhập lý do từ chối","error")}}))});
