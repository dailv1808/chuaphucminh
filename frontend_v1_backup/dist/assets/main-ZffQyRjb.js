import{g as t}from"./config-BvOGzWpZ.js";document.addEventListener("alpine:init",()=>{Alpine.data("dashboardData",()=>({stats:{pendingRegistrations:0,pendingChange:5.2,checkedInMeditators:0,checkedInChange:-2.1,tomorrowCheckins:0,tomorrowCheckouts:0,availableKuti:0,totalKuti:0,newQuestions:0},latestRegistrations:[],latestQuestions:[],showNotification:!1,notificationMessage:"",notificationType:"success",isLoading:!0,init(){this.fetchAllData()},async fetchAllData(){try{this.isLoading=!0;const e=await fetch(t("/api/registration/"));if(e.ok){const t=await e.json(),i=t.filter(t=>"pending"===t.status);this.stats.pendingRegistrations=i.length,this.stats.checkedInMeditators=t.filter(t=>"checked_in"===t.status).length;const a=new Date;a.setDate(a.getDate()+1);const s=a.toISOString().split("T")[0];this.stats.tomorrowCheckins=t.filter(t=>"approved"===t.status&&t.start_date===s).length,this.stats.tomorrowCheckouts=t.filter(t=>"checked_in"===t.status&&t.end_date===s).length,this.latestRegistrations=i.sort((t,e)=>new Date(e.created_at)-new Date(t.created_at)).slice(0,3)}const i=await fetch(t("/api/kuti/"));if(i.ok){const t=await i.json();this.stats.totalKuti=t.length,this.stats.availableKuti=t.filter(t=>t.is_available).length}const a=await fetch(t("/api/questions/"));if(a.ok){const t=await a.json();this.stats.newQuestions=t.filter(t=>"answered"!==t.status).length,this.latestQuestions=t.filter(t=>"answered"!==t.status).sort((t,e)=>new Date(e.created_at)-new Date(t.created_at)).slice(0,3)}}catch(e){console.error("Error fetching dashboard data:",e),this.showNotificationMessage("Có lỗi xảy ra khi tải dữ liệu","error")}finally{this.isLoading=!1}},formatDate(t){if(!t)return"N/A";return new Date(t).toLocaleDateString("vi-VN")},formatTimeAgo(t){if(!t)return"";const e=new Date(t),i=new Date,a=Math.floor((i-e)/1e3);return a<60?"vài giây trước":a<3600?`${Math.floor(a/60)} phút trước`:a<86400?`${Math.floor(a/3600)} giờ trước`:`${Math.floor(a/86400)} ngày trước`},calculateDuration(t,e){if(!t||!e)return 0;const i=new Date(t),a=new Date(e),s=Math.abs(a-i);return Math.ceil(s/864e5)},showNotificationMessage(t,e="success"){this.notificationMessage=t,this.notificationType=e,this.showNotification=!0,setTimeout(()=>{this.showNotification=!1},3e3)}}))});
