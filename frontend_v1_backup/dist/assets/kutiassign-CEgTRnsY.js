import{g as t}from"./config-BvOGzWpZ.js";import"./auth-BxmWGv8U.js";document.addEventListener("alpine:init",()=>{Alpine.data("kutiAssignData",()=>({kutis:[],registrations:[],filteredKutis:[],searchQuery:"",isLoading:!0,showNotification:!1,notificationMessage:"",notificationType:"success",init(){this.fetchData()},async fetchData(){try{this.isLoading=!0;const i=localStorage.getItem("access_token"),e=await fetch(t("/api/kuti/"),{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);this.kutis=await e.json(),console.log("Kutis data:",this.kutis);const r=await fetch(t("/api/registration/"));if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);this.registrations=await r.json(),console.log("Registrations data:",this.registrations),this.filteredKutis=[...this.kutis]}catch(i){console.error("Error fetching data:",i),this.showNotificationMessage(`Có lỗi xảy ra khi tải dữ liệu: ${i.message}`,"error")}finally{this.isLoading=!1}},getUserById(t){if(!t)return null;const i=this.registrations.find(i=>i.id===t);return console.log(`Looking for user ${t}, found:`,i),i||null},formatDate(t){if(!t)return"N/A";try{return new Date(t).toLocaleDateString("vi-VN")}catch(i){return console.error("Error formatting date:",t,i),"N/A"}},formatDateRange(t,i){if(!t||!i)return"N/A";try{return`${this.formatDate(t)} - ${this.formatDate(i)}`}catch(e){return console.error("Error formatting date range:",t,i,e),"N/A"}},filterKutis(){if(!this.searchQuery)return void(this.filteredKutis=[...this.kutis]);const t=this.searchQuery.toLowerCase().trim();this.filteredKutis=this.kutis.filter(i=>{if(i.code&&i.code.toLowerCase().includes(t))return!0;if(i.current_registration){const e=this.getUserById(i.current_registration);if(e){if(e.fullname&&e.fullname.toLowerCase().includes(t))return!0;if(e.username&&e.username.includes(t))return!0}}return!1})},showNotificationMessage(t,i="success"){this.notificationMessage=t,this.notificationType=i,this.showNotification=!0,setTimeout(()=>{this.showNotification=!1},5e3)}}))});
